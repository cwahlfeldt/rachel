<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="tailwind.css">
  <style>
    body {
      color: #222;
    }
    .container {
      padding: 20px;
      width: 100%;
      max-width: 900px;
      height: 100vh;
    }
  </style>
</head>
<body>

  <main class="w-screen h-screen bg-grey-light">
    <div class="container mx-auto">
      <div class="flex flex-col justify-center items-center w-full h-full">
        <p class="font-serif font-thin leading-normal">
          Ipsum corrupti sequi neque et veniam Harum sequi molestias quae saepe excepturi Architecto nemo voluptate libero voluptates magnam, veniam Assumenda exercitationem officia alias sit tempore qui Eius fugiat velit blanditiis
        </p>
        <div id="etsy-list"></div>
      </div>
    </div>
  </main>

  <footer>
    <!-- <script src="https://openapi.etsy.com/v2/users/mbvogffn/favorites/listings.js?callback=getData&api_key=gcalwyyac4uifehylaze5m01"></script> -->
    <!-- <script src="https://openapi.etsy.com/v2/users/mbvogffn/favorites/listings/.js?callback=getData&api_key=gcalwyyac4uifehylaze5m01"></script> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch-jsonp/1.1.3/fetch-jsonp.min.js"></script>
    <script src="https://unpkg.com/hyperapp"></script>
    <script>
      const {h, app} = window.hyperapp
      const fetch = window.fetchJsonp
      const username = `mbvogffn`
      const users = query => `https://openapi.etsy.com/v2/users/${username}${query}.js?callback=getData&api_key=gcalwyyac4uifehylaze5m01`
      const listings = query => `https://openapi.etsy.com/v2/listings/${query}.js?callback=getData&api_key=gcalwyyac4uifehylaze5m01`

      const state = {data: null}
      const actions = {
        setData: data => state => ({data}),
        getData: () => async (state, actions) => {
          const favoriteIds = await fetch(users(`/favorites/listings`)).then(data => data.json()).catch(err => err.message)
          //console.log(favoriteIds)
          const data = await Promise.all(
            favoriteIds.results.map(async id => {
              return await fetch(listings(`/${id.listing_id}/images`)).then(data => data.json()).catch(err => err.message)
            })
          )
          console.log(data)
          actions.setData(data)
        },
      }
      const View = (state, actions) =>
        h(
          `section`,
          {oncreate: actions.getData},
          [
            !(state.data) &&
            h(
              `div`,
              {},
              `I love you so much!`
            ),
            (state.data !== null) &&
            h(
              `section`,
              {class: `my-12 flex flex-row items-center justify-center`},
              (state.data) && state.data.map(item =>
                h(
                  `a`,
                  {
                    class: `w-1/5 p-3`,
                    href: `https://www.etsy.com/listing/${item.params.listing_id}`,
                  },
                  h(
                    `img`,
                    {
                      src: item.results[0].url_fullxfull,
                      class: `etsy-imageh-auto`,
                    }
                  )
                )
              )
            ),
          ]
        )
      const appI = app(state, actions, View, document.getElementById(`etsy-list`))
    </script>
  </footer>

</body>
</html>
